/*! ij - v0.1.0 - 2016-04-27 */
var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){},row:null,column:null,object:null,state:null,setState:function(a){this.state=a},getState:function(){return this.state}};return b=Class.create(b),a.DataCell=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){}};return b=Class.create(b),a.State=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){},setState:function(a){this.state=a},getState:function(){return this.state}};return b=Class.create(b),a.DataHeader=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(a){if(a)for(var b in a)this[b]=a[b]},params:{},dataprovider:null,controller:null,renderer:null,cache:null,workspace:null,cellsMap:[],init:function(a){for(var b in a)this.params[b]=a[b]},setWorkspace:function(a){return console.log(a),"undefined"!=typeof a?this.workspace=a:this.workspace=document.body,this},getWorkspace:function(){return this.workspace},setDataProvider:function(b){return"undefined"!=typeof b?this.dataprovider=b:this.dataprovider=new a.IIJDataProvider(this),this.dataprovider},setController:function(b){return b?this.controller=b:this.controller=new a.IIJController(this),this.controller},setRenderer:function(b){return b?this.renderer=b:this.renderer=new a.IIJRenderer(this),this},_checkDependencies:function(){return console.log("Something is missing : "),console.log("Checking DataProvider : ",this.dataProvider),console.log("Checking controller : ",this.controller),console.log("Checking DataProvider : ",this.renderer),console.log("Checking Workspace : ",this.workspace),console.log("Checking DataHandler : ",this.dataHandler),!!(this.renderer&&this.dataProvider&&this.dataHandler&&this.controller&&this.workspace)},getRenderedRows:function(a){var b=[];if(a)for(var c=0;c<a.length;c++)b.push(this.renderer.renderRow(a[c],c));return b},getRenderedColumns:function(a){var b=[];if(a)for(var c=0;c<a.length;c++)b.push(this.renderer.renderColumn(a[c],c));return b},buildRenderedTree:function(a,b){var c=(new Date,{}),d=[],e=[];c.root=[];for(var f=0;f<a.length;f++)for(var g=c.root,h="",i=0;i<a[f].length;i++){if(e[a[f][i].id]?a[f][i].cannotReRoot||(h=e[a[f][i].id]):e[a[f][i].id]=h,h+=a[f][i].id,d[h]){if(i>0){var j=!1;for(var k in g)if(g[k].id&&g[k].id==a[f][i].id){j=!0;break}if(j!==!0&&"true"!=j){var l=a[f][i].id,m=d[h];this._deleteNode(l,c.root),g.push(m),delete d[h],d[h]=m}}a[f].length-1>i&&(d[h].children||(d[h].children=[],d[h].object&&(d[h].children.push(this._cloneHeader(a[f][i],b)),d[h].children[0].object=d[h].object,delete d[h].object)))}else{if(g instanceof Array||(g=[]),a[f][i].type=b,g.push(a[f][i]),a[f].length-1>i&&(a[f][i].children=[],a[f][i].object&&(a[f][i].children.push(this._cloneHeader(a[f][i],b)),delete a[f][i].object),a[f][i].hasSummary&&!this.hideSummaries)){var n=this.renderer.renderSummary(a[f][i],b);n.summary=!0,a[f][i].children.push(n)}d[h]=a[f][i]}g=d[h].children}return c.root},_deleteNode:function(a,b){for(var c in b)b[c].id==a?delete b[c]:b[c].children&&this._deleteNode(a,b[c].children)},_cloneHeader:function(a,b){var c={};for(var d in a)if("label"==d)c[d]=a[d]+" [object]";else{if("children"==d)continue;"order"==d?c[d]=-1:"id"==d?c[d]=a[d]+"_child":"rendering"==d?c[d]=this.renderer.setId(a[d],this.renderer.getIdPrefix(b)+c.id):c[d]=a[d]}return c.type=b,c},orderRenderedTree:function(a,b){b||(b="order");var c=(new Date,[]),d=[];for(var e in a)c[a[e][b]]||(c[a[e][b]]=[]),c[a[e][b]].push(a[e]),a[e].children&&(a[e].children=this.orderRenderedTree(a[e].children,b));c[-1]&&(d=d.concat(this.alphabeticalSort(c[-1])));for(e in c)-1!=e&&(d=d.concat(this.alphabeticalSort(c[e])));return d},alphabeticalSort:function(a){return this.sortAlphabetically?a.sort(function(a,b){return a.label<b.label?-1:a.label>b.label?1:0}):a},getTreeDepth:function(a){var b=0;for(var c in a)if(a[c].children){var d=this.getTreeDepth(a[c].children);a[c].group=!0,d>b&&(b=d)}return b+1},applyTreeDepth:function(a,b){new Date;for(var c in a)a[c].children&&a[c].open===!0?(a[c].depth=1,a[c].children=this.applyTreeDepth(a[c].children,b-1)):a[c].depth=b;return a},populateSummaries:function(a){for(var b in a){if(a[b].hasSummary&&a[b].open===!0){a[b].children[a[b].children.length-1].object=[];var c=this._getObjectsFromTree(a[b].children,!1);a[b].children[a[b].children.length-1].object=c}a[b].children&&a[b].open===!0&&this.populateSummaries(a[b].children)}},_preRenderColumns:function(a,b){console.profile("_preRenderColumns");var c;if(a)c=this.getRenderedColumns(a),c=this.buildRenderedTree(c,"columnHeader"),c=this.orderRenderedTree(c);else{if(!this.columns||!this.columns.rendering)return;c=this.columns.rendering}for(var d in c)c[d]=this.getGroupSpan(c[d]).renderedTreeNode;this.hideSummaries||this.populateSummaries(c);var e=this.getTreeDepth(c);return this.applyTreeDepth(c,e),this.applyOnRenderedObjects(c,this.renderer.applyColSpan.bind(this.renderer),"span"),this.applyOnRenderedObjects(c,this.renderer.applyRowSpan.bind(this.renderer),"depth"),this.applyClasses(c,this.renderer.addClasses.bind(this.renderer),null,b),console.profileEnd(),{depth:e,rendering:c}},displayColumns:function(a,b){var c=this.renderer.renderColumnsContainer(),d=this.buildColumns(a.rendering),e={rendering:this.renderer.renderLeftUpperCorner(),colspan:b||1,rowspan:a.depth||1};e.rendering=this.renderer.applyColSpan(e.rendering,e.colspan),e.rendering=this.renderer.applyRowSpan(e.rendering,e.rowspan),a.rendering.length>0&&d[1].unshift(e.rendering);for(var f in d){var g=this.renderer.renderColumnsLevelContainer();for(var h in d[f])this._appendChild(g,d[f][h]);this._appendChild(c,g)}this._appendChild(this.container,c)},buildColumns:function(a,b){b="undefined"!=typeof b?b:1;var c=[];c[b]=[];for(var d in a)if(a[d]=this.renderer.reRenderColumn(a[d],this._getHeaderEventsCallbacks(a[d])),c[b].push(a[d].rendering),a[d].children&&a[d].open!==!1){var e=this.buildColumns(a[d].children,b+1);for(var f in e){c[f]||(c[f]=[]);for(var g in e[f])c[f].push(e[f][g])}}return c},_preRenderRows:function(a,b){console.profile("rows");var c;if(a)c=this.buildRenderedTree(this.getRenderedRows(a),"rowHeader"),c=this.orderRenderedTree(c);else{if(!this.rows||!this.rows.rendering)return;c=this.rows.rendering}for(var d in c)c[d]=this.getGroupSpan(c[d],1).renderedTreeNode;this.hideSummaries||this.populateSummaries(c);var e=this.getTreeDepth(c);return this.applyTreeDepth(c,e),this.applyOnRenderedObjects(c,this.renderer.applyRowSpan.bind(this.renderer),"span"),this.applyOnRenderedObjects(c,this.renderer.applyColSpan.bind(this.renderer),"depth"),this.applyClasses(c,this.renderer.addClasses.bind(this.renderer),null,b),console.profileEnd(),{depth:e,rendering:c}},displayData:function(a,b){this.container||(this.container=this.renderer.renderContainer());var c=this.renderer.renderRowsContainer();a=a&&b?this.buildRows(a.rendering,b).rows:a?this.buildRows(a.rendering,null).rows:this.buildMatrix();for(var d in a)this._appendChild(c,a[d]);this._appendChild(this.container,c)},buildMatrix:function(){var a,b,c=this.dataprovider.getData(),d=[];console.log(c);for(var e=0;e<c.length;e++){b=[],a=this.renderer.renderRowContainer();for(var f=0;f<c[e].length;f++)b.push(this.renderer.renderCell([e],[f],c[e][f],this._getCellEventsCallbacks([e],[f])));this._appendChildren(a,b),d.push(a)}return d},applyOnRenderedObjects:function(a,b,c){for(var d in a)a[d].rendering=b(a[d].rendering,a[d][c]),a[d].children&&(a[d].children=this.applyOnRenderedObjects(a[d].children,b,c));return a},applyClasses:function(a,b,c,d){c||(c=0);for(var e in a){var f,g,h=[];if(a[e].children)for(this.applyClasses(a[e].children,b,c,d),f=a[e].group===!0&&a[e].open===!1?c+1:c+this.getObjectsGrouped(a[e].children).length,g=c;f>g;g++)h.push(g);else if(void 0!==a[e].object)for(f=c+1,g=c;f>g;g++)h.push(g);c=f,a[e].rendering=b(a[e].rendering,a[e].type,h,d)}return a},buildRows:function(a,b,c){c||(c=0);var d=[];if(a.length>0)for(var e in a){var f,g=this.renderer.renderRowContainer();if(a[e].children&&a[e].open===!1&&(a[e].rendering=this.renderer.applyRowSpan(a[e].rendering,2)),a[e]=this.renderer.reRenderRow(a[e],this._getHeaderEventsCallbacks(a[e])),this._appendChild(g,a[e].rendering),a[e].summary)f=this._renderRowSummary(b,c,a[e]),this._appendChildren(g,f),c++,d.push(g);else if(a[e].object)f=this._renderRowData(b,c,a[e]),this._appendChildren(g,f),c++,d.push(g);else if(a[e].children&&a[e].open!==!1){d.push(g);var h=this.buildRows(a[e].children,b,c);d=d.concat(h.rows),c=h.rowNumber}else{d.push(g);var i=this._renderAggregateRowData(b,c,a[e]);c++,d=d.concat(i)}}return{rows:d,rowNumber:c}},_renderGlobalRow:function(a,b,c){},_renderAggregateRowData:function(a,b,c){for(var d=[],e=[],f=this.renderer.renderRowContainer(),g=this.getColumnsNumbersFromObjects(a),h=0;h<g.length;h++){var i=this.dataprovider.getData(this._getObjectsFromTree(c.children,!1),a[h].object||a[h].summary||a[h].group,null,{group:!0});e.push(this.renderer.renderCell([b],g[h],i,this._getCellEventsCallbacks([b],g[h])))}return this._appendChildren(f,e),d.push(f),d},_renderRowData:function(a,b,c){for(var d=this.getColumnsNumbersFromObjects(a),e=[],f=[b],g=0;g<d.length;g++){var h=this.dataprovider.getData([c.object],a[g].object||a[g].summary||a[g].group);e.push(this.renderer.renderCell(f,d[g],h,this._getCellEventsCallbacks(f,d[g])))}return e},_renderRowSummary:function(a,b,c){var d=this.getColumnsNumbersFromObjects(a),e=[],f=[];f.push(b);for(var g=0;g<d.length;g++){var h=this.dataprovider.getData(c.object,a[g].object||a[g].summary||a[g].group,null,{summary:!0});e.push(this.renderer.renderCell(f,d[g],h,this._getCellEventsCallbacks(f,d[g])))}return e},_appendChild:function(a,b){return this.renderer.appendChild(a,b)},_appendChildren:function(a,b){for(var c=0;c<b.length;c++)this._appendChild(a,b[c]);return a},getGroupSpan:function(a,b){if(b||(b=0),a.children&&a.open!==!1){var c=b;for(var d in a.children)b+=this.getGroupSpan(a.children[d],c).span}else b=a.children&&"rowHeader"==a.type?2:1;return a.span=b,{renderedTreeNode:a,span:b}},display:function(){this.container||(this.container=this.renderer.renderContainer());var a=new Date,b=this._preRenderColumns(this.dataprovider.getColumns());console.log("column pre-render : "+(new Date-a)),console.log("columns",b);var c=this._preRenderRows(this.dataprovider.getRows());c&&(this.rows=c),console.log("rows pre-render : "+(new Date-a)),console.log("rows : ",c),b?(this.columns=b,this.displayColumns(b,c.depth),console.log("appendColumns : "+(new Date-a)),this.displayData(c,this.getObjectsGrouped(b.rendering))):this.displayData(c),console.log("appendData & pre-display : "+(new Date-a)),this._appendChild(this.workspace,this.container),console.log("displayed : "+(new Date-a)),console.log("rows & columns structures :"),console.log(c,b)},_getCellEventsCallbacks:function(a,b){return{mouseover:this.onCellHover.bind(this,a,b),mouseout:this.onCellOut.bind(this,a,b),click:this.onCellClick.bind(this,a,b)}},_getHeaderEventsCallbacks:function(a){return{mouseover:this.onHeaderHover.bind(this,a),mouseout:this.onHeaderOut.bind(this,a),click:this.onHeaderClick.bind(this,a)}},update:function(){},exportToCSV:function(){},exportMatrix:function(){},getHeaderType:function(a){return a.type},getRowObject:function(a,b){var c=this.getObjectsGrouped(this.rows.rendering)[a];return c.object||c.summary||c.group},getRowsObjects:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.getRowObject(a[d],b);e instanceof Array?c=c.concat(e):c.push(e)}return c},getColumnObject:function(a,b){var c=this.getObjectsGrouped(this.columns.rendering)[a];return c.object||c.summary||c.group},getColumnsObjects:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.getColumnObject(a[d],b);e instanceof Array?c=c.concat(e):c.push(e)}return c},getRowNumber:function(a){this.rowsObjects||(this.rowsObjects=this._getObjectsFromTree(this.rows.rendering,!0));for(var b=0;b<this.rowsObjects.length;b++)if(JSON.stringify(this.rowsObjects[b])==JSON.stringify(a))return b;return-1},getColumnNumber:function(a){this.columnsObjects||(this.columnsObjects=this._getObjectsFromTree(this.columns.rendering,!0));for(var b=0;b<this.columnsObjects.length;b++)if(JSON.stringify(this.columnsObjects[b])==JSON.stringify(a))return b;return-1},getColumnsNumbersFromObjects:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=[],b[c].push(c);return b},getAllRowsObjects:function(){return this.rowsObjects||(this.rowsObjects=this._getObjectsFromTree(this.rows.rendering,!0)),this.rowsObjects},getAllColumnsObjects:function(){return this.columnsObjects||(this.columnsObjects=this._getObjectsFromTree(this.columns.rendering,!0)),this.columnsObjects},getRowsNumber:function(){return this.rowsObjects||(this.rowsObjects=this._getObjectsFromTree(this.rows.rendering,!0)),this.rowsObjects},getColumnsNumber:function(){return this.columnsObjects||(this.columnsObjects=this._getObjectsFromTree(this.columns.rendering,!0)),this.columnsObjects.length},getNodeFromProperty:function(a,b,c){var d=null;for(var e in c)if(c[e][a]==b?d=c[e]:c[e].children&&(d=this.getNodeFromProperty(a,b,c[e].children)),null!==d)break;return d},matchNodesFromProperty:function(a,b,c){var d,e=[];if("rowHeader"==c){if(!this.rows)return[];d=this.rows.rendering}else{if("columnHeader"!=c)return;if(!this.columns)return[];d=this.columns.rendering}for(var f in d)if(d[f][a].indexOf(b)>-1)e.push(d[f]);else{if(!d[f].children||d[f].open!==!0)continue;var g=this.getNodeFromProperty(a,b,d[f].children);g&&(e=e.concat(g))}return e},getObjectsGrouped:function(a){var b=[];if(void 0===typeof a)return[];for(var c in a)if(a[c].open===!1&&a[c].children)b.push({group:this._getObjectsFromTree(a[c].children)});else if(a[c].children){var d=this.getObjectsGrouped(a[c].children);d&&(b=b.concat(d))}else a[c].summary?b.push({summary:a[c].object}):void 0!==a[c].object&&b.push({object:[a[c].object]});if(0!==b.length)return b},_getObjectsFromTree:function(a,b){var c=[];for(var d in a)b===!0&&a[d].summary&&a[d].object?c=c.concat(a[d].object):a[d].object&&!a[d].summary&&c.push(a[d].object),a[d].children&&(c=c.concat(this._getObjectsFromTree(a[d].children,b)));return c},onResize:function(){},beforeCellClick:function(){},onCellClick:function(a,b,c){console.log(a,b),console.log(this.getRowsObjects(a,!0),this.getColumnsObjects(b,!0)),this.controller.onCellClick&&this.controller.onCellClick(c,this.dataprovider.getData(this.getRowsObjects(a,!0),this.getColumnsObjects(b,!0)),this.getRowsObjects(a,!0),this.getColumnsObjects(b,!0))},onCellHover:function(a,b,c){this.controller.onCellHover&&this.controller.onCellHover(c)},onCellOut:function(a,b,c){this.controller.onCellOut&&this.controller.onCellOut(c)},onCellRightClick:function(){},onCellDoubleClick:function(){},onHeaderClick:function(a,b){this.controller.onHeaderClick&&this.controller.onHeaderClick(b,a)},onHeaderHover:function(a){this.controller.onHeaderHover&&this.controller.onHeaderHover(a)},onHeaderOut:function(a){this.controller.onHeaderOut&&this.controller.onHeaderOut(a)},onHeaderRightClick:function(){},onHeaderDoubleClick:function(){},graphicalRowFilter:function(a){},dataRowFilter:function(a){},graphicalColumnFilter:function(a){},dataColumnFilter:function(a){},graphicalCellFilter:function(a){},dataCellFilter:function(a){},set:function(a,b){return this[a]=b,this},toggleHeader:function(a){a.open===!1?a.open=!0:a.open=!1},toggleHeaderVisibility:function(a){a.hidden===!1?a.hidden=!0:a.hidden=!1},refresh:function(a){var b=new Date;if(this.renderer.clearOutput(this.workspace),this.container=this.renderer.renderContainer(),"columnHeader"==a){var c=this._preRenderColumns(null,{reset:!0});this.columns=c}else if("rowHeader"==a){var d=this._preRenderRows(null,{reset:!0});this.rows=d}this.columns&&this.displayColumns(this.columns,this.rows.depth),console.log("appendColumns : "+(new Date-b)),this.columns?this.displayData(this.rows,this.getObjectsGrouped(this.columns.rendering)):this.displayData(this.rows),console.log("get columns by group"),console.log("appendData & pre-display : "+(new Date-b)),this._appendChild(this.workspace,this.container),console.log("displayed : "+(new Date-b)),console.log(this.rows,this.columns)}};return b=Class.create(b),a.Core=b,a.extend=Class.extend,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(a){},onCellHover:function(a,b){},onCellClick:function(a,b){},onCellOut:function(a,b){},onHeaderHover:function(a,b){},onHeaderOut:function(a,b){},onHeaderClick:function(a,b){},onGraphicalRowFilter:function(a){}};return b=Class.create(b),a.IIJController=b,a.extend=Class.extend,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){},aggregateData:function(a,b,c){}};return b=Class.create(b),a.Aggregator=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){},getData:function(){},getRows:function(){},getColumns:function(){},getIntersection:function(a,b){},getParentId:function(a){},getId:function(a){}};return b=Class.create(b),a.IIJDataProvider=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){},addClasses:function(a,b,c){if(c&&(a.className=""),b)for(var d=0;d<b.length;d++)a.classList.add(b[d]);return a},addAttribute:function(a,b,c){return a.setAttribute(b,c),a},addCSS:function(a,b,c){return a.style[b]=c,a},createElementWithText:function(a,b,c){var d=this.createElement(a,c),e=document.createTextNode(b);return d.appendChild(e),d},createElement:function(a,b){var c=document.createElement(a);return b&&this.addClasses(c,b),c},appendChild:function(a,b,c){var d=[];if(c){for(;a.firstChild;)d.push(a.firstChild),a.removeChild(a.firstChild);a.appendChild(b);for(var e=0;e<d.length;e++)a.appendChild(d[e]);return a}return a.appendChild(b)}};return b=Class.create(b),a.HTMLRenderer=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){this.template={}},addClassPrefix:function(a,b){this.template[a]||(this.template[a]={}),this.template[a].classPrefix=b},addIdPrefix:function(a,b){this.template[a]||(this.template[a]={}),this.template[a].idPrefix=b},getAttribute:function(a,b){return this.template[a]?this.template[a][b]:null}};return b=Class.create(b),a.HTMLTemplate=b,a}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(a){var b={initialize:function(){this.renderer=new enioka.ij.HTMLRenderer,this.template=new enioka.ij.HTMLTemplate},renderRowsContainer:function(){},renderRow:function(a){},applyRowSpan:function(a,b){},applyColSpan:function(a,b){},renderRowContainer:function(){},renderSubTotalHeader:function(a){},renderColumn:function(a){},renderLeftUpperCorner:function(){},renderColumnsLevelContainer:function(){},renderColumnsContainer:function(){},renderCell:function(a,b,c){},renderContainer:function(){},setCSSProperty:function(a,b,c){},emptyCSSProperty:function(a,b){},addClasses:function(a,b,c){},getRenderingId:function(a){return a.id},getRenderingClasses:function(a){return a.classList},setId:function(a,b){},getClassPrefix:function(a){},getIdPrefix:function(a){},addEventsToRendering:function(a,b){},clearOutput:function(a){}};return b=Class.create(b),a.IIJRenderer=b,a}(enioka.ij||{});