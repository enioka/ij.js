var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(){this.template={}},addClassPrefix:function(e,r){this.template[e]||(this.template[e]={}),this.template[e].classPrefix=r},addIdPrefix:function(e,r){this.template[e]||(this.template[e]={}),this.template[e].idPrefix=r},getAttribute:function(e,r){return this.template[e]?this.template[e][r]:null}};return r=Class.create(r),e.HTMLTemplate=r,e}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(){},addClasses:function(e,r,n){if(n&&(e.className=""),r)for(var t=0;t<r.length;t++)e.classList.add(r[t]);return e},addAttribute:function(e,r,n){return e.setAttribute(r,n),e},addCSS:function(e,r,n){return e.style[r]=n,e},createElementWithText:function(e,r,n){var t=this.createElement(e,n),i=document.createTextNode(r);return t.appendChild(i),t},createElement:function(e,r){var n=document.createElement(e);return r&&this.addClasses(n,r),n},appendChild:function(e,r){return e.appendChild(r)}};return r=Class.create(r),e.HTMLRenderer=r,e}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(){this.renderer=new enioka.ij.HTMLRenderer,this.template=new enioka.ij.HTMLTemplate},renderRowsContainer:function(){},renderRow:function(e){},applyRowSpan:function(e,r){},applyColSpan:function(e,r){},renderRowContainer:function(){},renderSubTotalHeader:function(e){},renderColumn:function(e){},renderLeftUpperCorner:function(){},renderColumnsLevelContainer:function(){},renderColumnsContainer:function(){},renderCell:function(e,r,n){},renderContainer:function(){},setCSSProperty:function(e,r,n){},emptyCSSProperty:function(e,r){},addClasses:function(e,r,n){},getRenderingId:function(e){return e.id},getRenderingClasses:function(e){return e.classList},renderRowsContainer:function(){},renderRow:function(e,r){},applyRowSpan:function(e,r){},applyColSpan:function(e,r){},renderRowContainer:function(){},renderSubTotalHeader:function(e){},renderColumn:function(e,r){},renderLeftUpperCorner:function(){},renderColumnsLevelContainer:function(){},renderColumnsContainer:function(){},renderSummary:function(e){},renderCell:function(e,r,n,t){},_getSummaryHoverCell:function(e){},appendChild:function(e,r){},renderContainer:function(){},setCSSProperty:function(e,r,n){},emptyCSSProperty:function(e,r){},addClasses:function(e,r,n){},setId:function(e,r){},getClassPrefix:function(e){},getIdPrefix:function(e){},addEventsToRendering:function(e,r){},clearOutput:function(e){}};return r=Class.create(r),e.IIJRenderer=r,e}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(e){},onCellHover:function(e,r){},onCellClick:function(e,r){},onCellOut:function(e,r){},onHeaderHover:function(e,r){},onHeaderOut:function(e,r){},onHeaderClick:function(e,r){},onGraphicalRowFilter:function(e){}};return r=Class.create(r),e.IIJController=r,e.extend=Class.extend,e}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(){},aggregateData:function(e,r,n){}};return r=Class.create(r),e.Aggregator=r,e}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(){},getData:function(){},getRows:function(){},getColumns:function(){},getIntersection:function(e,r){},getParentId:function(e){},getId:function(e){}};return r=Class.create(r),e.IIJDataProvider=r,e}(enioka.ij||{});var enioka=enioka||{};enioka.ij=function(e){var r={initialize:function(r){if(!r)return this.setController(new e.IIJController),this.setRenderer(new e.IIJRenderer),void this.setDataProvider(new e.IIJDataProvider);for(var n in r)this[n]=r[n]},params:{},dataprovider:null,controller:null,renderer:null,cache:null,workspace:null,cellsMap:[],init:function(e){for(var r in e)this.params[r]=e[r]},setWorkspace:function(e){return console.log(e),"undefined"!=typeof e?this.workspace=e:this.workspace=document.body,this},getWorkspace:function(){return this.workspace},setDataProvider:function(r){return"undefined"!=typeof r?this.dataprovider=r:this.dataprovider=new e.IIJDataProvider(this),this.dataprovider},setController:function(r){return r?this.controller=r:this.controller=new e.IIJController(this),this.controller},setRenderer:function(r){return r?this.renderer=r:this.renderer=new e.IIJRenderer(this),this},_checkDependencies:function(){return console.log("Something is missing : "),console.log("Checking DataProvider : ",this.dataProvider),console.log("Checking controller : ",this.controller),console.log("Checking DataProvider : ",this.renderer),console.log("Checking Workspace : ",this.workspace),console.log("Checking DataHandler : ",this.dataHandler),this.renderer&&this.dataProvider&&this.dataHandler&&this.controller&&this.workspace?!0:!1},getRenderedRows:function(e){var r=new Array;if(e)for(var n=0;n<e.length;n++)r.push(this.renderer.renderRow(e[n],n));return r},getRenderedColumns:function(e){var r=new Array;if(e)for(var n=0;n<e.length;n++)r.push(this.renderer.renderColumn(e[n],n));return r},buildRenderedTree:function(e,r){var n=(new Date,{}),t=new Array,i=new Array;n.root=new Array;for(var o=0;o<e.length;o++)for(var s=(new Array,n.root),a=new String,l=0;l<e[o].length;l++){if(a+=e[o][l].id,i[e[o][l].id]?a=i[e[o][l].id]:i[e[o][l].id]=a,t[a]){if(l>0){for(var d=!1,c=0;c<s.length;c++)if(s[c].id&&s[c].id==e[o][l].id){d=!0;break}if(1!=d){var u=e[o][l].id,h=t[a];this._deleteNode(u,n.root),s.push(h),delete t[a],t[a]=h}}e[o].length-1>l&&(t[a].children||(t[a].children=new Array,t[a].object&&(t[a].children.push(this._cloneHeader(e[o][l],r)),t[a].children[0].object=t[a].object,delete t[a].object)))}else{if(!s instanceof Array&&(s=new Array),e[o][l].type=r,s.push(e[o][l]),e[o].length-1>l&&(e[o][l].children=new Array,e[o][l].object&&(e[o][l].children.push(this._cloneHeader(e[o][l],r)),delete e[o][l].object),e[o][l].hasSummary)){var p=this.renderer.renderSummary(e[o][l],r);p.summary=!0,e[o][l].children.push(p)}t[a]=e[o][l]}s=t[a].children}return n.root},_deleteNode:function(e,r){for(var n in r)r[n].id==e?delete r[n]:r[n].children&&this._deleteNode(e,r[n].children)},_cloneHeader:function(e,r){var n={};for(var t in e)if("label"==t)n[t]=e[t]+" [object]";else{if("children"==t)continue;"order"==t?n[t]=-1:"id"==t?n[t]=e[t]+"_child":"rendering"==t?n[t]=this.renderer.setId(e[t],this.renderer.getIdPrefix(r)+n.id):n[t]=e[t]}return n.type=r,n},orderRenderedTree:function(e){var r=(new Date,new Array),n=new Array;for(var t in e)r[e[t].order]||(r[e[t].order]=new Array),r[e[t].order].push(e[t]),e[t].children&&(e[t].children=this.orderRenderedTree(e[t].children));console.log(r),r[-1]&&(n=n.concat(this.alphabeticalSort(r[-1])));for(var t in r)-1!=t&&(n=n.concat(this.alphabeticalSort(r[t])));return n},alphabeticalSort:function(e){return e.sort(function(e,r){return e.label<r.label?-1:e.label>r.label?1:0})},getTreeDepth:function(e){var r=0;for(var n in e)if(e[n].children){var t=this.getTreeDepth(e[n].children);e[n].group=!0,t>r&&(r=t)}return r+1},applyTreeDepth:function(e,r){new Date;for(var n in e)e[n].children&&1==e[n].open?(e[n].depth=1,e[n].children=this.applyTreeDepth(e[n].children,r-1)):e[n].depth=r;return e},populateSummaries:function(e){for(var r in e){if(e[r].hasSummary&&1==e[r].open){e[r].children[e[r].children.length-1].object=new Array;var n=this._getObjectsFromTree(e[r].children,!1);console.log(n),e[r].children[e[r].children.length-1].object=n}e[r].children&&1==e[r].open&&this.populateSummaries(e[r].children)}},_preRenderColumns:function(e,r){if(console.profile("_preRenderColumns"),e){var n=this.getRenderedColumns(e),n=this.buildRenderedTree(n,"columnHeader");n=this.orderRenderedTree(n)}else{if(!this.columns||!this.columns.rendering)return;var n=this.columns.rendering}for(var t in n)n[t]=this.getGroupSpan(n[t]).renderedTreeNode;this.hideSummaries||this.populateSummaries(n);var i=this.getTreeDepth(n);return this.applyTreeDepth(n,i),this.applyOnRenderedObjects(n,this.renderer.applyColSpan.bind(this.renderer),"span"),this.applyOnRenderedObjects(n,this.renderer.applyRowSpan.bind(this.renderer),"depth"),this.applyClasses(n,this.renderer.addClasses.bind(this.renderer),null,r),console.profileEnd(),{depth:i,rendering:n}},displayColumns:function(e,r){var n=this.renderer.renderColumnsContainer(),t=this.buildColumns(e.rendering),i={rendering:this.renderer.renderLeftUpperCorner(),colspan:r||1,rowspan:e.depth||1};i.rendering=this.renderer.applyColSpan(i.rendering,i.colspan),i.rendering=this.renderer.applyRowSpan(i.rendering,i.rowspan),e.rendering.length>0&&t[1].unshift(i.rendering);for(var o in t){var s=this.renderer.renderColumnsLevelContainer();for(var a in t[o])this._appendChild(s,t[o][a]);this._appendChild(n,s)}this._appendChild(this.container,n)},buildColumns:function(e,r){r="undefined"!=typeof r?r:1;var n=new Array;n[r]=new Array;for(var t in e)if(e[t]=this.renderer.reRenderColumn(e[t],this._getHeaderEventsCallbacks(e[t])),n[r].push(e[t].rendering),e[t].children&&0!=e[t].open&&"false"!=e[t].open){var i=this.buildColumns(e[t].children,r+1);for(var o in i){n[o]||(n[o]=new Array);for(var s in i[o])n[o].push(i[o][s])}}return n},_preRenderRows:function(e,r){if(console.profile("rows"),e){var n=this.buildRenderedTree(this.getRenderedRows(e),"rowHeader");n=this.orderRenderedTree(n)}else{if(!this.rows||!this.rows.rendering)return;var n=this.rows.rendering}for(var t in n)n[t]=this.getGroupSpan(n[t],1).renderedTreeNode;this.hideSummaries||this.populateSummaries(n);var i=this.getTreeDepth(n);return this.applyTreeDepth(n,i),this.applyOnRenderedObjects(n,this.renderer.applyRowSpan.bind(this.renderer),"span"),this.applyOnRenderedObjects(n,this.renderer.applyColSpan.bind(this.renderer),"depth"),this.applyClasses(n,this.renderer.addClasses.bind(this.renderer),null,r),console.profileEnd(),{depth:i,rendering:n}},displayData:function(e,r){this.container||(this.container=this.renderer.renderContainer());var n=this.renderer.renderRowsContainer();e=e&&r?this.buildRows(e.rendering,r).rows:e?this.buildRows(e.rendering,null).rows:this.buildMatrix();for(var t in e)this._appendChild(n,e[t]);this._appendChild(this.container,n)},buildMatrix:function(){var e,r,n=this.dataprovider.getData(),t=new Array;console.log(n);for(var i=0;i<n.length;i++){r=new Array,e=this.renderer.renderRowContainer();for(var o=0;o<n[i].length;o++)r.push(this.renderer.renderCell([i],[o],n[i][o],this._getCellEventsCallbacks([i],[o])));this._appendChildren(e,r),t.push(e)}return t},applyOnRenderedObjects:function(e,r,n){for(var t in e)e[t].rendering=r(e[t].rendering,e[t][n]),e[t].children&&(e[t].children=this.applyOnRenderedObjects(e[t].children,r,n));return e},applyClasses:function(e,r,n,t){if(!n)var n=0;for(var i in e){var o=new Array;if(e[i].children){if(this.applyClasses(e[i].children,r,n,t),1==e[i].group&&0==e[i].open)var s=n+1;else var s=n+this.getObjectsGrouped(e[i].children).length;for(var a=n;s>a;a++)o.push(a)}else if(e[i].object)for(var s=n+1,a=n;s>a;a++)o.push(a);n=s,e[i].rendering=r(e[i].rendering,e[i].type,o,t)}return e},buildRows:function(e,r,n){if(!n)var n=0;var t=new Array;if(e.length>0)for(var i in e){var o=this.renderer.renderRowContainer();if(!e[i].children||"false"!=e[i].open&&0!=e[i].open||(e[i].rendering=this.renderer.applyRowSpan(e[i].rendering,2)),e[i].rendering=this.renderer.addEventsToRendering(e[i].rendering,this._getHeaderEventsCallbacks(e[i])),this._appendChild(o,e[i].rendering),e[i].summary){var s=this._renderRowSummary(r,n,e[i]);this._appendChildren(o,s),n++,t.push(o)}else if(e[i].object){var s=this._renderRowData(r,n,e[i]);this._appendChildren(o,s),n++,t.push(o)}else if(e[i].children&&"false"!=e[i].open&&0!=e[i].open){t.push(o);var a=this.buildRows(e[i].children,r,n);t=t.concat(a.rows),n=a.rowNumber}else{t.push(o);var l=this._renderAggregateRowData(r,n,e[i]);n++,t=t.concat(l)}}return{rows:t,rowNumber:n}},_renderGlobalRow:function(e,r,n){},_renderAggregateRowData:function(e,r,n){for(var t=new Array,i=new Array,o=this.renderer.renderRowContainer(),s=this.getColumnsNumbersFromObjects(e),a=0;a<s.length;a++){var l=this.dataprovider.getData(this._getObjectsFromTree(n.children,!1),e[a].object||e[a].summary||e[a].group,null,{group:!0});i.push(this.renderer.renderCell([r],s[a],l,this._getCellEventsCallbacks([r],s[a])))}return this._appendChildren(o,i),t.push(o),t},_renderRowData:function(e,r,n){for(var t=this.getColumnsNumbersFromObjects(e),i=new Array,o=[r],s=0;s<t.length;s++){var a=this.dataprovider.getData([n.object],e[s].object||e[s].summary||e[s].group);i.push(this.renderer.renderCell(o,t[s],a,this._getCellEventsCallbacks(o,t[s])))}return i},_renderRowSummary:function(e,r,n){var t=this.getColumnsNumbersFromObjects(e),i=new Array,o=new Array;o.push(r);for(var s=0;s<t.length;s++){var a=this.dataprovider.getData(n.object,e[s].object||e[s].summary||e[s].group,null,{summary:!0});i.push(this.renderer.renderCell(o,t[s],a,this._getCellEventsCallbacks(o,t[s])))}return i},_appendChild:function(e,r){return this.renderer.appendChild(e,r)},_appendChildren:function(e,r){for(var n=0;n<r.length;n++)this._appendChild(e,r[n]);return e},getGroupSpan:function(e,r){if(r||(r=0),e.children&&"false"!=e.open&&0!=e.open){var n=r;for(var t in e.children)r+=this.getGroupSpan(e.children[t],n).span}else r=e.children&&"rowHeader"==e.type?2:1;return e.span=r,{renderedTreeNode:e,span:r}},display:function(){this.container||(this.container=this.renderer.renderContainer());var e=new Date,r=this._preRenderColumns(this.dataprovider.getColumns());r&&(this.columns=r),info_debug("column pre-render : "+(new Date-e)),info_debug("columns",r);var n=this._preRenderRows(this.dataprovider.getRows());n&&(this.rows=n),info_debug("rows pre-render : "+(new Date-e)),info_debug("rows pre-render : ",n),r&&this.displayColumns(r,n.depth),info_debug("appendColumns : "+(new Date-e)),r?this.displayData(n,this.getObjectsGrouped(r.rendering)):this.displayData(n),console.log("get columns by group"),info_debug("appendData & pre-display : "+(new Date-e)),this._appendChild(this.workspace,this.container),info_debug("displayed : "+(new Date-e)),console.log(n,r)},_getCellEventsCallbacks:function(e,r){return{mouseover:this.onCellHover.bind(this,e,r),mouseout:this.onCellOut.bind(this,e,r),click:this.onCellClick.bind(this,e,r)}},_getHeaderEventsCallbacks:function(e){return{mouseover:this.onHeaderHover.bind(this,e),mouseout:this.onHeaderOut.bind(this,e),click:this.onHeaderClick.bind(this,e)}},update:function(){},exportToCSV:function(){},exportMatrix:function(){},getHeaderType:function(e){return e.type},getRowObject:function(e,r){var n=this.getObjectsGrouped(this.rows.rendering)[e];return n.object||n.summary||n.group},getRowsObjects:function(e,r){for(var n=new Array,t=0;t<e.length;t++){var i=this.getRowObject(e[t],r);i instanceof Array?n=n.concat(i):n.push(i)}return n},getColumnObject:function(e,r){var n=this.getObjectsGrouped(this.columns.rendering)[e];return n.object||n.summary||n.group},getColumnsObjects:function(e,r){for(var n=new Array,t=0;t<e.length;t++){var i=this.getColumnObject(e[t],r);i instanceof Array?n=n.concat(i):n.push(i)}return n},getRowNumber:function(e){this.rowsObjects||(this.rowsObjects=this._getObjectsFromTree(this.rows.rendering,!0));for(var r=0;r<this.rowsObjects.length;r++)if(JSON.stringify(this.rowsObjects[r])==JSON.stringify(e))return r;return-1},getColumnNumber:function(e){this.columnsObjects||(this.columnsObjects=this._getObjectsFromTree(this.columns.rendering,!0));for(var r=0;r<this.columnsObjects.length;r++)if(JSON.stringify(this.columnsObjects[r])==JSON.stringify(e))return r;return-1},getColumnsNumbersFromObjects:function(e){for(var r=new Array,n=0;n<e.length;n++)r[n]=new Array,r[n].push(n);return r},getAllRowsObjects:function(){return this.rowsObjects||(this.rowsObjects=this._getObjectsFromTree(this.rows.rendering,!0)),this.rowsObjects},getAllColumnsObjects:function(){return this.columnsObjects||(this.columnsObjects=this._getObjectsFromTree(this.columns.rendering,!0)),this.columnsObjects},getRowsNumber:function(){return this.rowsObjects||(this.rowsObjects=this._getObjectsFromTree(this.rows.rendering,!0)),this.rowsObjects},getColumnsNumber:function(){return this.columnsObjects||(this.columnsObjects=this._getObjectsFromTree(this.columns.rendering,!0)),this.columnsObjects.length},getNodeFromProperty:function(e,r,n){var t=null;for(var i in n)if(n[i][e]==r?t=n[i]:n[i].children&&(t=this.getNodeFromProperty(e,r,n[i].children)),null!=t)break;return t},matchNodesFromProperty:function(e,r,n){var t=new Array;if("rowHeader"==n){if(!this.rows)return[];var i=this.rows.rendering}else{if("columnHeader"!=n)return;if(!this.columns)return[];var i=this.columns.rendering}for(var o in i)if(i[o][e].indexOf(r)>-1)t.push(i[o]);else{if(!i[o].children||1!=i[o].open&&"true"!=i[o].open)continue;var s=this.getNodeFromProperty(e,r,i[o].children);s&&(t=t.concat(s))}return t},getObjectsGrouped:function(e){var r=[];if(void 0==typeof e)return[];for(var n in e)if(0!=e[n].open&&"false"!=e[n].open||!e[n].children)if(e[n].children){var t=this.getObjectsGrouped(e[n].children);t&&(r=r.concat(t))}else e[n].summary?r.push({summary:e[n].object}):e[n].object&&r.push({object:[e[n].object]});else r.push({group:this._getObjectsFromTree(e[n].children)});if(0!=r.length)return r},_getObjectsFromTree:function(e,r){var n=new Array;for(var t in e)1==r&&e[t].summary&&e[t].object?n=n.concat(e[t].object):e[t].object&&!e[t].summary&&n.push(e[t].object),e[t].children&&(n=n.concat(this._getObjectsFromTree(e[t].children,r)));return n},onResize:function(){},beforeCellClick:function(){},onCellClick:function(e,r,n){console.log(e,r),console.log(this.getRowsObjects(e,!0),this.getColumnsObjects(r,!0)),this.controller.onCellClick&&this.controller.onCellClick(n,this.dataprovider.getData(this.getRowsObjects(e,!0),this.getColumnsObjects(r,!0)),this.getRowsObjects(e,!0),this.getColumnsObjects(r,!0))},onCellHover:function(e,r,n){this.controller.onCellHover&&this.controller.onCellHover(n)},onCellOut:function(e,r,n){this.controller.onCellOut&&this.controller.onCellOut(n)},onCellRightClick:function(){},onCellDoubleClick:function(){},onHeaderClick:function(e,r){this.controller.onHeaderClick&&this.controller.onHeaderClick(r,e)},onHeaderHover:function(e){this.controller.onHeaderHover&&this.controller.onHeaderHover(e)},onHeaderOut:function(e){this.controller.onHeaderOut&&this.controller.onHeaderOut(e)},onHeaderRightClick:function(){},onHeaderDoubleClick:function(){},graphicalRowFilter:function(e){},dataRowFilter:function(e){},graphicalColumnFilter:function(e){},dataColumnFilter:function(e){},graphicalCellFilter:function(e){},dataCellFilter:function(e){},set:function(e,r){return this[e]=r,this},toggleHeader:function(e){0==e.open||"false"==e.open?e.open=!0:e.open=!1},toggleHeaderVisibility:function(e){0==e.hidden||"false"==e.hidden?e.hidden=!0:e.hidden=!1},refresh:function(e){var r=new Date;if(this.renderer.clearOutput(this.workspace),this.container=this.renderer.renderContainer(),"columnHeader"==e){var n=this._preRenderColumns(null,{reset:!0});this.columns=n}else if("rowHeader"==e){var t=this._preRenderRows(null,{reset:!0});this.rows=t}this.columns&&this.displayColumns(this.columns,this.rows.depth),info_debug("appendColumns : "+(new Date-r)),this.columns?this.displayData(this.rows,this.getObjectsGrouped(this.columns.rendering)):this.displayData(this.rows),console.log("get columns by group"),info_debug("appendData & pre-display : "+(new Date-r)),this._appendChild(this.workspace,this.container),info_debug("displayed : "+(new Date-r)),console.log(this.rows,this.columns)}};return r=Class.create(r),e.Core=r,e.extend=Class.extend,e}(enioka.ij||{});
